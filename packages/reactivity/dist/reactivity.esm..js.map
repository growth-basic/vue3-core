{
  "version": 3,
  "sources": ["../src/effect.ts", "../../shared/src/index.ts", "../src/reactive.ts"],
  "sourcesContent": ["// import { ReactiveEffect } from \"vue\";\nexport let activeEffect; // \u5F53\u524D\u6B63\u5728\u6267\u884C\u7684effect\nclass ReactiveEffect {\n  public active = true; // effect\u662F\u5426\u662F\u6FC0\u6D3B\u7684\n  public deps = []; // effect\u7684\u4F9D\u8D56\u6709\u54EA\u4E9B\n  public parent = undefined;\n  constructor(public fn) {}\n  run() {\n    if (!this.active) {\n      return this.fn(); // \u5982\u679Ceffect\u4E0D\u662F\u6FC0\u6D3B\u7684\u76F4\u63A5\u6267\u884C\u6B64\u51FD\u6570\n    }\n    // \u5176\u4ED6\u7684\u6FC0\u6D3B\u7684\u88C5\u586B\n    // \u6536\u96C6\u5F53\u524D\u8FD9\u4E2Aeffect\u4F9D\u8D56\u54EA\u4E9B\u5C5E\u6027\n    try {\n      this.parent = activeEffect;\n      activeEffect = this;\n      return this.fn(); // \u6267\u884C\u5B8C\u6BD5\u540E, \u5F53effect\u51FD\u6570\u6267\u884C\u7684\u65F6\u5019\u83B7\u53D6\u54CD\u5E94\u5F0F\u7684\u5C5E\u6027\n    } finally {\n      activeEffect = this.parent; // \u53BB\u9664\u7236\u7EA7\u7684effect\n      this.parent = null;\n    }\n  }\n}\n// \u4F9D\u8D56\u6536\u96C6\uFF0C\u5C31\u662F\u5C06\u5F53\u524D\u7684effect\u53D8\u6210\u5168\u5C40\u7684\uFF0C\u7A0D\u540E\u53D6\u503C\u7684\u65F6\u5019\u53EF\u4EE5\u62FF\u5230\u8FD9\u4E2A\u5168\u5C40\u6B63\u5728\u6FC0\u6D3B\u7684effect\nexport function effect(fn) {\n  const _effect = new ReactiveEffect(fn);\n  _effect.run();\n}\n\n// \u6620\u5C04\u8868\u7684\u8BBE\u8BA1\n// 1. \u4E00\u4E2A\u5BF9\u8C61\u4E2D\u5C5E\u6027\u53EF\u80FD\u5728\u591A\u4E2Aeffect\u4E2D\u4F7F\u7528\n//\nconst targetMap = new WeakMap();\nexport function track(target, key) {\n  // target\u4EE3\u7406\u5BF9\u8C61\u7684\u53D6\u503C\u6CA1\u6709\u53D1\u751F\u5728effect\u4E2D\n  if (!activeEffect) {\n    return;\n  }\n  //\n  let depsMap = targetMap.get(target);\n  if (!depsMap) {\n    // \u7B2C\u4E00\u6B21\u83B7\u53D6\u7684\u65F6\u5019, key \u662F\u4E00\u4E2A\u5B57\u7B26\u4E32\n    targetMap.set(target, (depsMap = new Map()));\n  }\n  let dep = depsMap.get(key);\n  if (!dep) {\n    depsMap.set(key, (dep = new Set()));\n  }\n  let shouldTrack = !dep.has(activeEffect);\n  if (shouldTrack) {\n    dep.add(activeEffect); // \u5C5E\u6027\u8BB0\u4F4Feffect\n    activeEffect.deps.push(dep); // effect\u6536\u96C6\u5C5E\u6027, \u540E\u7EED\u9700\u8981\u4F7F\u7528effect\u505A\u6E05\u7406\u5DE5\u4F5C\n    // \u4E00\u4E2A\u5C5E\u6027\u5BF9\u63A5\u591A\u4E2Aeffect \u4E00\u4E2Aeffect\u4F1A\u6709\u591A\u4E2A\u5C5E\u6027 \u591A\u5BF9\u591A\u7684\u5173\u7CFB\n  }\n}\n", "export function isObject(value) {\n  return value !== null && typeof value === \"object\";\n}\n", "import { isObject } from \"@vue/shared\";\nimport { activeEffect, track } from \"./effect\";\nexport const enum ReactiveFlags {\n  IS_REACTIVE = \"_v_isReactive\",\n}\n// \u62BD\u51FA\u6765\uFF0C\u4E3A\u4E86\u540E\u7EED\u7528\u4E8E\u6DF1\u5C42\u6B21\u9012\u5F52\nconst mutableHandlers = {\n  get(target, key, receiver) {\n    if (ReactiveFlags.IS_REACTIVE === key) {\n      return true;\n    }\n    console.log(activeEffect, key);\n    track(target, key);\n    return Reflect.get(target, key, receiver);\n  },\n  set(target, key, value, receiver) {\n    return Reflect.set(target, key, value, receiver);\n  },\n};\n\nconst reactiveMap = new WeakMap(); // key\u53EA\u80FD\u662F\u5BF9\u8C61\nexport function reactive(target) {\n  // \u4E0D\u5BF9\u975E\u5BF9\u8C61\u7684\u7C7B\u578B\u8FDB\u884C\u5904\u7406\n  if (!isObject(target)) {\n    return target;\n  }\n  // \u5F53targte\u662F\u4EE3\u7406\u8FC7\u7684\u5BF9\u8C61\u7684\u65F6\u5019\uFF0C\u4F1A\u89E6\u53D1get\u65B9\u6CD5,\u5F53get\u65B9\u6CD5\u4E2Dtarget[ReactiveFlags.IS_REACTIVE]\u53D1\u73B0\u8FD9\u4E2A\u5C5E\u6027\u662F\u88AB\u8C03\u79BB\u8FC7\u7684\u5C31\u76F4\u63A5\u8FD4\u56DE\n  // \u80FD\u89E6\u53D1get\u65B9\u6CD5\u7684\u80AF\u5B9A\u662F\u88AB\u4EE3\u7406\u8FC7\u7684\u5BF9\u8C61\n  if (target[ReactiveFlags.IS_REACTIVE]) {\n    return target;\n  }\n  // \u7F13\u5B58\u4EE3\u7406\u5BF9\u8C61\uFF0C\u4E0B\u6B21\u8FD9\u4E2A\u5BF9\u8C61\u518D\u8FDB\u884C\u4EE3\u7406\u7684\u65F6\u5019\u518D\u7F13\u5B58\u4E2D\u76F4\u63A5\u83B7\u53D6\n  const exisitsProxy = reactiveMap.get(target);\n  if (exisitsProxy) {\n    return exisitsProxy;\n  }\n  // \u8BBE\u7F6E\u4EE3\u7406\u5BF9\u8C61\uFF0C\u4F1A\u5728\u539F\u72EC\u4EAB\u4E0A\u8FDB\u884C\u83B7\u53D6\n  const proxy = new Proxy(target, mutableHandlers);\n\n  return proxy;\n}\n"],
  "mappings": ";AACO,IAAI;AACX,IAAM,iBAAN,MAAqB;AAAA,EAInB,YAAmB,IAAI;AAAJ;AAHnB,SAAO,SAAS;AAChB,SAAO,OAAO,CAAC;AACf,SAAO,SAAS;AAAA,EACQ;AAAA,EACxB,MAAM;AACJ,QAAI,CAAC,KAAK,QAAQ;AAChB,aAAO,KAAK,GAAG;AAAA,IACjB;AAGA,QAAI;AACF,WAAK,SAAS;AACd,qBAAe;AACf,aAAO,KAAK,GAAG;AAAA,IACjB,UAAE;AACA,qBAAe,KAAK;AACpB,WAAK,SAAS;AAAA,IAChB;AAAA,EACF;AACF;AAEO,SAAS,OAAO,IAAI;AACzB,QAAM,UAAU,IAAI,eAAe,EAAE;AACrC,UAAQ,IAAI;AACd;AAKA,IAAM,YAAY,oBAAI,QAAQ;AACvB,SAAS,MAAM,QAAQ,KAAK;AAEjC,MAAI,CAAC,cAAc;AACjB;AAAA,EACF;AAEA,MAAI,UAAU,UAAU,IAAI,MAAM;AAClC,MAAI,CAAC,SAAS;AAEZ,cAAU,IAAI,QAAS,UAAU,oBAAI,IAAI,CAAE;AAAA,EAC7C;AACA,MAAI,MAAM,QAAQ,IAAI,GAAG;AACzB,MAAI,CAAC,KAAK;AACR,YAAQ,IAAI,KAAM,MAAM,oBAAI,IAAI,CAAE;AAAA,EACpC;AACA,MAAI,cAAc,CAAC,IAAI,IAAI,YAAY;AACvC,MAAI,aAAa;AACf,QAAI,IAAI,YAAY;AACpB,iBAAa,KAAK,KAAK,GAAG;AAAA,EAE5B;AACF;;;ACtDO,SAAS,SAAS,OAAO;AAC9B,SAAO,UAAU,QAAQ,OAAO,UAAU;AAC5C;;;ACAO,IAAW,gBAAX,kBAAWA,mBAAX;AACL,EAAAA,eAAA,iBAAc;AADE,SAAAA;AAAA,GAAA;AAIlB,IAAM,kBAAkB;AAAA,EACtB,IAAI,QAAQ,KAAK,UAAU;AACzB,QAAI,sCAA8B,KAAK;AACrC,aAAO;AAAA,IACT;AACA,YAAQ,IAAI,cAAc,GAAG;AAC7B,UAAM,QAAQ,GAAG;AACjB,WAAO,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAAA,EAC1C;AAAA,EACA,IAAI,QAAQ,KAAK,OAAO,UAAU;AAChC,WAAO,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AAAA,EACjD;AACF;AAEA,IAAM,cAAc,oBAAI,QAAQ;AACzB,SAAS,SAAS,QAAQ;AAE/B,MAAI,CAAC,SAAS,MAAM,GAAG;AACrB,WAAO;AAAA,EACT;AAGA,MAAI,OAAO,oCAA4B;AACrC,WAAO;AAAA,EACT;AAEA,QAAM,eAAe,YAAY,IAAI,MAAM;AAC3C,MAAI,cAAc;AAChB,WAAO;AAAA,EACT;AAEA,QAAM,QAAQ,IAAI,MAAM,QAAQ,eAAe;AAE/C,SAAO;AACT;",
  "names": ["ReactiveFlags"]
}
